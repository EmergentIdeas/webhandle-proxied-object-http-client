{"version":3,"file":"index.js","mappings":"AACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDH,EAAwB,CAACS,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,8BCA3E,MAAMI,EAEZ,WAAAC,CAAYC,GACXX,OAAOY,OAAOC,KAAM,CACnBC,SAAU,GACRC,UAAW,GACXC,YAAa,GACbC,aAAc,IACdN,EACJ,CACA,oBAAAO,CAAqBC,GACpB,SAAWA,EAAI,GAAK,IAAIC,MAAM,QAC/B,CAEA,aAAAC,CAAchB,GACb,GAAIQ,KAAKC,SAASQ,SAASjB,GAC1B,MAAO,MAER,GAAIQ,KAAKG,YAAYM,SAASjB,GAC7B,MAAO,SAER,GAAIQ,KAAKE,UAAUO,SAASjB,GAC3B,MAAO,OAGR,GAAIA,EAAKkB,WAAW,OAAQ,CAC3B,IAAIC,EAAMnB,EAAKoB,UAAU,GAEzB,IAAIZ,KAAKK,qBAAqBM,GAC7B,MAAO,KAET,CACA,GAAInB,EAAKkB,WAAW,OAAQ,CAC3B,IAAIC,EAAMnB,EAAKoB,UAAU,GAEzB,IAAIZ,KAAKK,qBAAqBM,GAC7B,MAAO,KAET,CACA,GAAInB,EAAKkB,WAAW,UAAW,CAC9B,IAAIC,EAAMnB,EAAKoB,UAAU,GAEzB,IAAIZ,KAAKK,qBAAqBM,GAC7B,MAAO,QAET,CAEA,MAAO,MACR,CAEA,YAAAE,CAAarB,GAEZ,OADUQ,KAAKc,UAAYtB,CAE5B,CAEA,GAAAF,CAAIyB,EAAQvB,EAAMwB,GACjB,GAAIhB,KAAKI,aAAaK,SAASjB,GAC9B,OAAOyB,QAAQ3B,OAAO4B,WAGvB,IAAIC,EAAOnB,KAAKQ,cAAchB,GAC1B4B,EAAMpB,KAAKa,aAAarB,EAAM2B,GAK9BE,EAAUlC,OAAOY,OAAO,CAC3B,eAAgB,oBACdC,KAAKqB,SAER,OAAOC,kBAAmBC,GAEzB,IAAIC,EACJ,GAAY,QAATL,GACF,GAAGI,EAAKE,OAAS,EAAG,CAInB,IAAIC,EAAQH,EAAK,GACjB,GAAoB,iBAAVG,EAAoB,CAC7B,IAAIC,EAAQ,GACZ,IAAI,IAAI1C,KAAOE,OAAOyC,KAAKF,GAC1BC,EAAME,KAAKC,mBAAmB7C,GAAO,IAAM6C,mBAAmBJ,EAAMzC,KAErEmC,GAAO,IAAMO,EAAMI,KAAK,IAEzB,CACD,OAGAP,EAAOQ,KAAKC,UAAUV,GAIvB,IAAIzB,EAAU,CACboC,OAAQf,EACNE,QAASA,GAETG,IACF1B,EAAQ0B,KAAOQ,KAAKC,UAAUV,IAG/B,IAAIY,QAAiBC,MAAMhB,EAAKtB,GAChC,GAAsB,KAAnBqC,EAASE,OAAe,CAC1B,IAAIC,EAAQ,IAAIC,MAAM,0BAEtB,MADAD,EAAMH,SAAWA,EACXG,CACP,CAEA,aADiBH,EAASK,MAE3B,CACD,CAGA,GAAAC,CAAI1B,EAAQvB,EAAMkD,GACjB,GAAI1C,KAAKI,aAAaK,SAASjB,GAE9B,OADAuB,EAAOvB,GAAQkD,GACR,EAEP,MAAM,IAAIH,MAAM,gBAElB,EAec,SAASI,EAAa7C,EAAU,CAAC,EAAG8C,EAAa,CAAC,GAQhE,OANI9C,EAAQM,eACXN,EAAQM,aAAe,GACvBN,EAAQM,aAAayB,QAAQ1C,OAAO0D,oBAAoBD,KAG7C,IAAIE,MAAMF,EAAY,IAAIhD,EAAoBE,GAI3D,C","sources":["webpack://@webhandle/proxied-object-http-client/webpack/bootstrap","webpack://@webhandle/proxied-object-http-client/webpack/runtime/define property getters","webpack://@webhandle/proxied-object-http-client/webpack/runtime/hasOwnProperty shorthand","webpack://@webhandle/proxied-object-http-client/./client-lib/index.mjs"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export class ServiceWrapperProxy {\n\n\tconstructor(options) {\n\t\tObject.assign(this, {\n\t\t\tknownGet: []\n\t\t\t, knownPost: []\n\t\t\t, knownDelete: []\n\t\t\t, localMembers: []\n\t\t}, options)\n\t}\n\tisFirstCharLowerCase(str) {\n\t\treturn !!((str[0] + '').match(/[a-z]/))\n\t}\n\n\tdetermineVerb(prop) {\n\t\tif (this.knownGet.includes(prop)) {\n\t\t\treturn \"GET\"\n\t\t}\n\t\tif (this.knownDelete.includes(prop)) {\n\t\t\treturn \"DELETE\"\n\t\t}\n\t\tif (this.knownPost.includes(prop)) {\n\t\t\treturn \"POST\"\n\t\t}\n\n\t\tif (prop.startsWith('get')) {\n\t\t\tlet sub = prop.substring(3)\n\t\t\t// Only make this a get request if the next char is not lower case\n\t\t\tif(!this.isFirstCharLowerCase(sub)) {\n\t\t\t\treturn \"GET\"\n\t\t\t}\n\t\t}\n\t\tif (prop.startsWith('set')) {\n\t\t\tlet sub = prop.substring(3)\n\t\t\t// Only make this a put request if the next char is not lower case\n\t\t\tif(!this.isFirstCharLowerCase(sub)) {\n\t\t\t\treturn \"PUT\"\n\t\t\t}\n\t\t}\n\t\tif (prop.startsWith('delete')) {\n\t\t\tlet sub = prop.substring(6)\n\t\t\t// Only make this a delete request if the next char is not lower case\n\t\t\tif(!this.isFirstCharLowerCase(sub)) {\n\t\t\t\treturn \"DELETE\"\n\t\t\t}\n\t\t}\n\n\t\treturn \"POST\"\n\t}\n\n\tdetermineUrl(prop) {\n\t\tlet url = this.urlPrefix + prop\n\t\treturn url\n\t}\n\n\tget(target, prop, receiver) {\n\t\tif (this.localMembers.includes(prop)) {\n\t\t\treturn Reflect.get(...arguments);\n\t\t}\n\n\t\tlet verb = this.determineVerb(prop)\n\t\tlet url = this.determineUrl(prop, verb)\n\t\t\n\t\t\n\t\t\n\t\t\n\t\tlet headers = Object.assign({\n\t\t\t\"Content-Type\": \"application/json\"\n\t\t}, this.headers)\n\n\t\treturn async function (...args) {\n\n\t\t\tlet body\n\t\t\tif(verb === 'GET') {\n\t\t\t\tif(args.length > 0) {\n\t\t\t\t\t// If this is a get query, we can't just send a post body, we have to break it into \n\t\t\t\t\t// parameters. However, parameters are named and arguments are not... so let's assume\n\t\t\t\t\t// we have one object as the first argument and get the property names from that.\n\t\t\t\t\tlet first = args[0]\n\t\t\t\t\tif(typeof first === 'object') {\n\t\t\t\t\t\tlet parts = []\n\t\t\t\t\t\tfor(let key of Object.keys(first)) {\n\t\t\t\t\t\t\tparts.push(encodeURIComponent(key) + '=' + encodeURIComponent(first[key]))\n\t\t\t\t\t\t}\n\t\t\t\t\t\turl += \"?\" + parts.join('&')\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbody = JSON.stringify(args)\n\t\t\t}\n\t\t\t// console.log(`${url} (${verb}) ${JSON.stringify(body)}`)\n\t\t\t\n\t\t\tlet options = {\n\t\t\t\tmethod: verb\n\t\t\t\t, headers: headers\n\t\t\t}\n\t\t\tif(body) {\n\t\t\t\toptions.body = JSON.stringify(args)\n\t\t\t}\n\t\t\t\t\n\t\t\tlet response = await fetch(url, options)\n\t\t\tif(response.status != 200) {\n\t\t\t\tlet error = new Error('Could not make request')\n\t\t\t\terror.response = response\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\tlet data = await response.json()\n\t\t\treturn data\n\t\t}\n\t}\n\n\n\tset(target, prop, val) { \n\t\tif (this.localMembers.includes(prop)) {\n\t\t\ttarget[prop] = val;\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow new Error(\"Access denied\");\n\t\t}\n\t}\n}\n\n/**\n * \n * @param {object} options \n * @param {string} options.urlPrefix The prefixed use form making calls. It can be relative or absolute\n * but should probably end in a /\n * @param {array} [options.knownGet] Methods we have to use GET for\n * @param {array} [options.knownPost] Methods we have to use POST for\n * @param {array} [options.knowDelete] Methods we have to use DELETE for\n * @param {array} [options.localMembers] Members we should not attempt to make proxy calls for\n * @param {object} [options.headers] A map which should be included as headers on any call\n * @param {object} [baseObject] If included, the object that will be proxied\n */\nexport default function proxyService(options = {}, baseObject = {}) {\n\t\n\tif(!options.localMembers) {\n\t\toptions.localMembers = []\n\t\toptions.localMembers.push(...Object.getOwnPropertyNames(baseObject))\n\t}\n\n\tlet proxy = new Proxy(baseObject, new ServiceWrapperProxy(options));\n\treturn proxy\n\n\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","ServiceWrapperProxy","constructor","options","assign","this","knownGet","knownPost","knownDelete","localMembers","isFirstCharLowerCase","str","match","determineVerb","includes","startsWith","sub","substring","determineUrl","urlPrefix","target","receiver","Reflect","arguments","verb","url","headers","async","args","body","length","first","parts","keys","push","encodeURIComponent","join","JSON","stringify","method","response","fetch","status","error","Error","json","set","val","proxyService","baseObject","getOwnPropertyNames","Proxy"],"sourceRoot":""}